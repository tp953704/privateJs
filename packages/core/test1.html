<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        const a = {
            Private:{
                
                cm:18.8
            },
            Public:{
                age:18,
                name:'Evan',
                say:function(){
                    // console.log(this.age)
                    return this.age;
                }
            }
        }
        function OOClass(Params){
            const { Private,Public } = Params;
            const newObj = Object.create(null);
            for(let key in Private){
                newObj[`_${key}`]=Private[key];
            }
            for(let key in Public){
                newObj[`${key}`]=Public[key];
            }
            return newObj;
        }
        const Person = OOClass(a)
        const privateHandler = {
            get:function (target, propKey, receiver) {
                propKey = realPropKey(target,propKey);
                if(!Reflect.has(target, 'isCallBySelf')){
                    if(propKey.startsWith('_')){
                        throw new TypeError("Cannot call a private element");
                    }
                    console.log(Reflect.has(target, 'isCallBySelf'))
                    Reflect.set(target, 'isCallBySelf', true)
                }else{
                    Reflect.deleteProperty(target, 'isCallBySelf', true)
                }
                return Reflect.get(target, propKey, receiver);
            },
        }

        const privateBind = new Proxy(Person, privateHandler)
        // privateBind._age;
        // console.log(privateBind.say())
        function realPropKey(target,propKey){
    if(!Reflect.has(target, propKey)){
        console.log(propKey)
        if(!Reflect.has(target, `_${propKey}`)){
            throw new TypeError(`there is no ${propKey} element`);
        }else{
            console.log(Reflect.get(target, `_${propKey}`))
            propKey = `_${propKey}`;
        }
    }
    return propKey;
}
    
    
        // console.log(Person)


        const a1 = {
            Private:{
                cm:9,
                age:28,
            },
            Public:{
                
                name:'Evan!',
                sayMan:function(){
                    // console.log(this.age)
                    return this.cm;
                }
            }
        };
        const IsHasPropKey =(Class,propKey)=>{
            let privateProp = propKey;
            let publicProp = propKey;
            if(propKey.startsWith('_')){
                // 砍掉第一個字
                publicProp = propKey.substring(1,propKey.length)
            }else{
                privateProp = `_${propKey}`;
            }
            return Reflect.has(Class,publicProp) || Reflect.has(Class,privateProp);
        }
        // const aa ='123';
        // console.log(aa.substring(1,aa.length))
        function inherit(a1,Person){
            const newClass = OOClass(a1);
            for(let p in Person){
               
                if(!p.startsWith('_')){
                
                    if(!IsHasPropKey(newClass,p)){
                        Reflect.set(newClass,p,Person[p])
                    }
                    
                }
            }
            // new Proxy(newClass, privateHandler)
            return new Proxy(newClass, privateHandler);
        }
        const PP = inherit(a1,privateBind);
        console.log(PP.name)
    </script>
</body>
</html>